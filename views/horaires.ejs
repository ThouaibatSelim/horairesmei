<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Horaires</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body {
      font-family: sans-serif;
      padding: 20px;
      background-color: #f9f9f9;
      color: #333;
    }
    .ligne {
      background: white;
      padding: 15px;
      border: 1px solid #ccc;
      border-radius: 8px;
      box-shadow: 0 1px 3px rgba(0,0,0,0.05);
      overflow-x: auto;
      white-space: nowrap;
    }
    .jour { font-weight: bold; color: #2c3e50; }
    .horaire { margin: 0 6px; color: #145214; }
    .rdv { margin-left: 10px; color: #cc0000; font-weight: bold; }
    .separator { margin: 0 12px; color: #999; }
  </style>
</head>
<body>

  <div class="ligne">
   <%
  const jours = ['lundi','mardi','mercredi','jeudi','vendredi','samedi','dimanche'];
  const groupByJour = {};

  horaires.forEach(h => {
    if (!groupByJour[h.jour]) groupByJour[h.jour] = { publics: [], rdvs: [] };
    if (h.type === 'public') groupByJour[h.jour].publics.push(h);
    if (h.type === 'rdv') groupByJour[h.jour].rdvs.push(h);
  });

  let rendu = [];

  jours.forEach(jour => {
    const bloc = groupByJour[jour];

    if (!bloc) {
      rendu.push(`<span class="jour">${jour.charAt(0).toUpperCase() + jour.slice(1)} :</span> <span class="horaire">Fermé</span>`);
      return;
    }

    const horairesValides = bloc.publics
      .filter(h => h.ouverture && h.fermeture)
      .sort((a, b) => a.ouverture.localeCompare(b.ouverture));

    if (horairesValides.length === 0) {
      const commentaireFerme = bloc.publics.concat(bloc.rdvs).find(h => h.commentaire && h.commentaire.toLowerCase().includes('fermé'));
      if (commentaireFerme) {
        rendu.push(`<span class="jour">${jour.charAt(0).toUpperCase() + jour.slice(1)} :</span> <span class="horaire">${commentaireFerme.commentaire}</span>`);
      } else {
        rendu.push(`<span class="jour">${jour.charAt(0).toUpperCase() + jour.slice(1)} :</span> <span class="horaire">Fermé</span>`);
      }
      return;
    }

    const horaires = horairesValides.map(h =>
      `<span class="horaire">${h.ouverture.slice(0,5)} - ${h.fermeture.slice(0,5)}</span>`
    ).join(' ');

    const rdv = bloc.rdvs.map(h =>
      `<span class="rdv">${'(Sur Rendez-Vous)'}</span>`
    ).join(' ');

    rendu.push(`
      <span class="jour">${jour.charAt(0).toUpperCase() + jour.slice(1)} :</span>
      ${horaires} ${rdv}
    `);
  });
%>


    <%- rendu.join('<span class="separator">|</span>') %>
  </div>
</body>
</html>
